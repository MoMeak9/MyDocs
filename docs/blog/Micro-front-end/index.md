# 课题研究——微前端

## 定义

![image-20220308145600688](https://mc-web-1259409954.cos.ap-guangzhou.myqcloud.com/MyImages/202203081456819.png)

### 什么是微前端？

**微前端**一词于 2016 年底首次出现在[ThoughtWorks 技术雷达](https://www.thoughtworks.com/radar/techniques/micro-frontends)中。它将微服务的概念扩展到前端世界。当前的趋势是构建一个功能丰富且功能强大的浏览器应用程序，也就是单页应用程序，它位于微服务架构之上。随着时间的推移，通常由单独的团队开发的前端层会增长并且变得更加难以维护。这就是我们所说的[前端单体Frontend Monolith](https://www.youtube.com/watch?v=pU1gXA0rfwc)。

微前端背后的想法是将网站或 Web 应用程序视为由**独立团队拥有** **的功能的组合**。每个团队都有**不同的业务领域**或**任务**，它关心和专注于。一个团队是**跨职能**的，从数据库到用户界面，**端到端地**开发其功能。

然而，这个想法并不新鲜。[它与自包含系统的](http://scs-architecture.org/)概念有很多共同之处。在过去，这种方法被称为[垂直系统的前端集成](https://dev.otto.de/2014/07/29/scaling-with-microservices-and-vertical-decomposition/)。但微前端显然是一个更友好、更简洁的术语。

**单片前端** ![单片前端](https://micro-frontends.org/ressources/diagrams/organisational/monolith-frontback-microservices.png)

**垂直组织** ![具有微前端的端到端团队](https://micro-frontends.org/ressources/diagrams/organisational/verticals-headline.png)

## 微前端背后的核心思想

- **与技术无关**
  每个团队都应该能够选择和升级他们的堆栈，而无需与其他团队协调。[自定义元素](https://micro-frontends.org/#the-dom-is-the-api)是隐藏实现细节同时为其他人提供中性界面的好方法。
- **隔离团队代码**
  不要共享运行时，即使所有团队都使用相同的框架。构建自包含的独立应用程序。不要依赖共享状态或全局变量。
- **建立团队前缀**
  就尚无法隔离的命名约定达成一致。命名空间 CSS、事件、本地存储和 Cookie，以避免冲突并明确所有权。
- **优先使用本机浏览器功能而不是自定义 API**
  使用[浏览器事件进行通信](https://micro-frontends.org/#parent-child-communication--dom-modification)，而不是构建全局 Pub/Sub 系统。如果你真的需要构建一个跨团队的 API，尽量让它尽可能简单。
- **构建弹性站点**
  即使 JavaScript 失败或尚未执行，您的功能也应该很有用。使用[通用渲染](https://micro-frontends.org/#serverside-rendering--universal-rendering)和渐进增强来提高感知性能。

## 为什么不使用Ifram

为什么不用 iframe，这几乎是所有微前端方案第一个会被 challenge 的问题。但是大部分微前端方案又不约而同放弃了 iframe 方案，自然是有原因的，并不是为了 "炫技" 或者刻意追求 "特立独行"。

*如果不考虑体验问题，iframe 几乎是最完美的微前端解决方案了。*

iframe 最大的特性就是提供了浏览器原生的硬隔离方案，不论是样式隔离、js 隔离这类问题统统都能被完美解决。但他的最大问题也在于他的隔离性无法被突破，导致应用间上下文无法被共享，随之带来的开发体验、产品体验的问题。

1. url 不同步。浏览器刷新 iframe url 状态丢失、后退前进按钮无法使用。
2. UI 不同步，DOM 结构不共享。想象一下屏幕右下角 1/4 的 iframe 里来一个带遮罩层的弹框，同时我们要求这个弹框要浏览器居中显示，还要浏览器 resize 时自动居中..

3. 全局上下文完全隔离，内存变量不共享。iframe 内外系统的通信、数据同步等需求，主应用的 cookie 要透传到根域名都不同的子应用中实现免登效果。
4. 慢。每次子应用进入都是一次浏览器上下文重建、资源重新加载的过程。

## 微前端的核心价值，巨石应用or技术栈无关？

参考：https://zhuanlan.zhihu.com/p/95085796

> **我认为微前端的核心价值在于 "技术栈无关"，这才是它诞生的理由，或者说这才是能说服我采用微前端方案的理由**

**ToB**

很少有 ToC 软件活得过 3 年以上的。而对于 ToB 应用而言，3~5 年太常见

所以<u>大部分企业应用</u>都会有一个核心的诉求，就是**如何确保我的遗产代码能平滑的迁移，以及如何确保我在若干年后还能用上时下热门的技术栈？**

**微前端首先解决的，是如何解构巨石应用**，从而解决巨石应用随着技术更迭、产品升级、人员流动带来的工程上的问题。

> 微前端的初衷应该还是来解决工程问题的，带来的产品价值在不同的领域可大可小。 比如在阿里云这种典型的云产品控制台的场景下，它带来的产品价值就会很可观。因为阿里云作为提供 IAAS 服务的云平台，它需要的就是平台、产品的被集成能力，在这种场景下，微前端能力能非常好的契合这个诉求。但需要强调的是，并不是所有采用微前端的客户，都是阿里云这种 IAAS 平台产品。很多中小型控制台大多没有产品自由组合能力的诉求。产品能力只能算是微前端的能力的一种延伸。

「技术栈无关」是架构上的准绳，具体到实现时，对应的就是：**应用之间不应该有任何直接或间接的技术栈、依赖、以及实现上的耦合。**

- 比如我们不能要求子应用、主应用必须使用某一版本的技术栈实现。

- 比如在通信机制的设计与选择上，尽量基于浏览器原生的 CustomEvent api，而不是自己搞的 pub/sub。

- 比如子应用是否具备不依赖宿主环境独立运行的能力，衡量标准是是否能一行代码不改，或者只改很少的配置，就能达成这一目标。

## 微前端技术实现方案

> https://zhuanlan.zhihu.com/p/78362028





![img](https://pic2.zhimg.com/80/v2-d55549366b52cde19c93835cfa2a58c9_720w.jpg)

## 乾坤 qiankun

https://qiankun.umijs.org/zh